<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Documentation</title>
	<link href="https://intouch.capillary.co.in/images/favicon_v3.ico" rel="icon" type="image/ico" />

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all_nosearch.js"></script>
	
	<script type="text/javascript" src="https://s3.amazonaws.com/assets.freshdesk.com/widget/freshwidget.js"></script>
	<style type="text/css" media="screen, projection">
		@import url(https://s3.amazonaws.com/assets.freshdesk.com/widget/freshwidget.css); 
	</style> 

  </head>

  <body class="index" data-languages="[]">
  
  
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.svg" />
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <hr>

<p>title: Capillary API Documentation</p>

<p>language_tabs:
  - json</p>

<p>toc_footers:
  - <b>Other API Documents</b>
  - <a href="https://capillary.github.io/v1.1-API-Documentation/">CRM API Documentation v1.1</a>
  - <a href="https://capillary.github.io/ecom-api-document/">AnywhereCommerce API Documentation</a></p>

<p>includes:
  - customer
  - transaction
  - customerLabels
  - otp
  - coupon
  - points
  - survey
  - userAuth
  - customerWalkin
  - verticals
  - org
  - staffUser
  - leads
  - userGroup
  - OrganizationSource
  - storeCare
  - events
  - integrations
  - eventNotifications
  - authEngine</p>

<h2 id="search-true">search: true</h2>

<h1 id="release-updates">Release Updates</h1>

<p>This section provides the quarterly breakup of existing API updates and new API releases.</p>

<h2 id="q2-releases-2020">Q2 Releases (2020)</h2>

<ul>
<li>Added new front-end authentication APIs under Auth Engine.</li>
</ul>

<h2 id="q4-releases-2019-20">Q4 Releases (2019-20)</h2>

<ul>
<li><strong>OAuth Support</strong>: Besides Basic Authentication, Capillary APIs now support OAuth and access tokens for more secured API calls. For more details, see support portal. </li>
<li><strong>Points Reversal</strong>: Allows reversing redeemed points directly if the transaction - for which the points are redeemed - is returned. A new redemption ID is introduced. 

<ul>
<li>  POST <a href="https://capillary.github.io/v1.1-API-Documentation/#redeem-points">v1.1/points/redeem</a>: Introduced a new parameter <code class="prettyprint">redemption_id</code> which can be used to reverse points if the transaction is returned.</li>
<li>POST <code class="prettyprint">v2/points/reverse</code>: Uses <code class="prettyprint">redemptionId</code> to reverse points of a specific transaction.</li>
<li>GET <a href="https://capillary.github.io/v1.1-API-Documentation/#get-customer-redemptions" target="_blank">v1.1/customer/redemptions</a><code class="prettyprint">v1.1/customer/redemptions</code></a>: Shows <code class="prettyprint">total_points_reversed</code> and points reversal history.</li>
</ul></li>
<li><strong>Event Notification</strong>: Allows building integrations with Capillary events that originate either through Capillary products or APIs. For more details, see  <a href="https://capillary.github.io/api-documentation/#event-notifications" target="_blank">Event Notification APIs</a>.</li>
<li><strong>Redemption across loyalty programs</strong>: With this release, you can redeem points earned in one program in another loyalty program of the org. 

<ul>
<li>POST <code class="prettyprint">v1.1/points/redeem</code>: <a href="https://capillary.github.io/v1.1-API-Documentation/#redeem-points" target="_blank">v1.1/points/redeem</a>A new parameter <code class="prettyprint">group_redemption</code> if set <code class="prettyprint">true</code> enables cross loyalty program redemption.<br></li>
</ul></li>
<li><strong>OTP Support without PII information</strong>: Allows non-PII clients (clients which would not send PII information such as mobile number, email ID, etc to Capillary) to send OTP via Capillary communication gateway.</li>
<li><strong>Transaction V2 APIs</strong>: Support to add and retrieve transaction in V2 APIs. Support to <a href="https://capillary.github.io/api-documentation/#add-transaction" target="_blank">Add transactions</a> and <a href="https://capillary.github.io/api-documentation/#get-transaction-details" target="_blank">Retrieve transaction details</a>.</li>
<li>Option to disable OTP validation for points transfer.</li>
<li>Customer enrollment with one-time points and tier upgrade</li>
<li>External loyalty program linking</li>
<li>Support for external reference number in redemption.</li>
</ul>

<h1 id="introduction">Introduction</h1>

<p>Capillary RESTful APIs are be consumed by Capillary and other brands that are registered with Capillary/MartJack to manage their CRM. Capillary V2 and V3 APIs support multiple sources such as InStore, MartJack, Facebook, and WeChat.</p>

<p>This document provides detailed information on all the APIs and guides in how to each API with the appropriate samples.</p>

<h2 id="source">Source</h2>

<p>Source is an entry through which a customer is registered. Unlike v1.1 APIs, v2.0 APIs provide extended support for multiple sources, i.e., you can now manage accounts of different sources such as InStore, MartJack, WeChat, e-commerce and Facebook.</p>

<p>V2.0 APIs also support multiple accounts of a single source. For example, an org could have multiple accounts of WeChat and Facebook. Each account will have a different account id. You would need to pass the respective account id when making API calls.</p>

<h2 id="account-ids">Account IDs</h2>

<p>An organization can have multiple accounts of a source (such as WeChat). Each account will have a unique account id. You can manage customers from different accounts by passing the respective account id along with the source.</p>

<h2 id="identifiers">Identifiers</h2>

<p>A customer identifier is a unique identifier that is used for registering in a source such as mobile number, email id, or external id. Identifier are also used to lookup customers and retrieve their capillary unique ids.</p>

<p>Capillary V2.0 APIs merge accounts automatically when a same identifier is registered in different sources.For example, assume that a customer has registered on InStore using his mobile number and e-commerce site using his email id. Now, if the customer registers the same mobile number in e-commerce site, the  accounts will be merged automatically to a single customer id. You can retrieve the customer details from various sources of an organization using the unique customer id.</p>

<p>Before starting with v2.0 APIs, it is important to understand different official accounts created for each source and the respective account ids.</p>

<h1 id="organization-setup">Organization Setup</h1>

<p>The following sub-sections guides you in authenticating your organization to use Capillary v2.0 APIs.</p>

<h2 id="authentication">Authentication</h2>

<p>Capillary supports two types of authentication.</p>

<p>Capillary APIs can be accessed either using Basic auth (TILL/Store Center credentials), or OAuth (Client key and secret associated with a Till/Store Center). Please note that it is mandatory to use only the store-specific Till/Store Center credentials as the data in the API response depends on this identification</p>

<p>To configure your API keys, see <a href="http://developer.capillarytech.com/en/support/solutions/articles/4000154305-oauth">API Authentication Configuration</a>.</p>

<p><strong>When to use Basic &amp; OAuth?</strong></p>

<table><thead>
<tr>
<th>Basic</th>
<th>oAuth</th>
</tr>
</thead><tbody>
<tr>
<td>Can be used for POS integrations where API requests come to Capillary server directly from POS front end or POS store server.</td>
<td>Shall be used for backend integrations (from one backend to another backend). For example, POS integrations where API requests come to Capillary server from API gateway or a central server; FTP integrations where backend service need to be authenticated; 3rd party integration where API requests come to Capillary from a backend platform.</td>
</tr>
</tbody></table>

<h3 id="process-1-basic-authentication">Process 1: Basic Authentication</h3>

<p>Authorization Header is used for validating authentication credentials. The Authorization Header is constructed as shown below:</p>

<p><code class="prettyprint">Authorization: Basic &lt;Base64 encoded (username: md5(password)&gt;</code></p>

<p>In the Authorization Header pass the Base64 decoded form of username and md5 formatted password.</p>

<p>For example, if the username is “store.server” and the password is &lsquo;server123&rsquo;, md5 of the password is 8a16a6b70505eb1f1ff7cdc0cd5559a7</p>

<p>Encode the username and md5 password to Base64, then the header is formed as shown below</p>

<p><code class="prettyprint">Authorization: Basic c3RvcmUuc2VydmVyOjhhMTZhNmI3MDUwNWViMWYxZmY3Y2RjMGNkNTU1OWE3</code></p>

<p>Now, v2 API supports submitting requests on behalf of other TILLs (active TILLs). In db the combination of attribution_lookup and lookup_code are mapped to TILL ids and org ids. When a new POST request is placed with the combination of a lookup name and lookup code, the data will be inserted in the db on behalf of the TILL that is mapped to the specified combination. </p>

<p>To submit requests on behalf of other TILLs, include the following code along with the HEADER: </p>

<p><code class="prettyprint">X-CAP-API-ATTRIBUTION-LOOKUP-TYPE:&lt;name&gt;</code>
<code class="prettyprint">X-CAP-API-ATTRIBUTION-LOOKUP:&lt;value&gt;</code>(value is case sensitive)</p>

<h3 id="headers-required-for-basic-authentication">Headers Required for Basic Authentication</h3>

<ul>
<li><p><strong>Content-Type</strong> - This should be set as application/json</p></li>
<li><p><strong>Accept</strong> - This should also be set as application/json</p></li>
</ul>

<h3 id="process-2-oauth">Process 2: OAuth</h3>

<p>OAuth provides better security and helps you create secure passages to access your org&rsquo;s data through Capillary APIs. To generate oAuth client key and secret see <a href="http://developer.capillarytech.com/en/support/solutions/articles/4000154305-oauth" target="_blank">OAuth Documentation</a>.</p>

<h4 id="generate-access-token">Generate Access Token</h4>

<p>Once you get key and secret, you can generate access token or JWT (JSON Web Token) using the token/generate API. JWT is a compact URL and JSON-based used to transfer data securely between two parties.</p>

<h4 id="resource-information">Resource Information</h4>

<table><thead>
<tr>
<th></th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>URI</td>
<td><code class="prettyprint">/oauth/token/generate</code></td>
</tr>
<tr>
<td>API Version</td>
<td>v3</td>
</tr>
<tr>
<td>HTTP Method</td>
<td>POST</td>
</tr>
<tr>
<td>Authentication Required?</td>
<td>No</td>
</tr>
<tr>
<td>Batch Support?</td>
<td>No</td>
</tr>
</tbody></table>

<h4 id="endpoint">Endpoint</h4>

<p><code class="prettyprint">https://{host}/v3/oauth/token/generate</code></p>

<h4 id="post-request-schema">POST Request Schema</h4>

<p><code class="prettyprint">
{
  &quot;key&quot;: &quot;&quot;,
  &quot;secret&quot;: &quot;&quot;
}
</code>
<aside class="notice">The token validity will be as per the value set for the client (Token expiry duration).</aside></p>

<blockquote>
<p>Sample Request</p>
</blockquote>
<pre class="highlight html"><code>https://eu.api.capillarytech.com/v3/oauth/token/generate
</code></pre>
<blockquote>
<p>Sample POST Request</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"WnCygRI1Fmlf6YudKwTxQq1LI"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hoqSBz6VwefECaZA8Q3oNx4V4H3pMDITksarZVES"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Sample Response</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nt">"accessToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJraWQiOiJrMSIsImFsZyI6IlJTMjU2In0.eyJpc3MiOiJDYXBpbGxhcnkiLCJleHAiOjE1NzUyNzAyNzAsImp0aSI6IjJaX2FqUjcwYzJABChVUjlDVTVpUlEiLCJpYXQiOjE1NzUyNjk5NzAsInN1YiI6Im5hbWVfODQzNjIwODIwMSIsImNsaWVudF9pZCI6MjEsIm9yZ19pZCI6MTExNSwidG9rZW5fdXNlIjoidG9rZW5fYWNjZXNzIn0.Ala1-XTDlPtrHFQfCtJKsXe3h_WVyq4QOGI3ZnLNJqOa-yJc1UPGbypUysWemzEaiQC_BJ0n9G68SYkVZGi4CSVOhHRNA_dILe8y1Sa90YZKwHVHogJmIKzLmksJrTbjn8s8hSMePBaaUcEdUZ1XssxdFrZhEHHN1fWVYtkdb74PB3sZ7OMDqKUysON8YTNQxLgKOJ3kq0o2QUUDQo1q3gxXFuswate6-jj3oBkcdd1ohhXkPIWZlAb_1lRcLr-ECaaBfh473gayeMVV_6khdKJ7cXrUQ3CXppkrPIzBb7rS6I93iWZw0IlmWbaGduTmPPOhLX6HZLOb84Y28st-cw"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"ttlSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id="other-headers-required">Other Headers Required</h3>

<ul>
<li><p><strong>Content type</strong> - This should be set as application/json</p></li>
<li><p><strong>Accept</strong> - This should also be set as application/json</p></li>
</ul>

<h3 id="using-access-token">Using Access Token</h3>

<p>Once you generate the access token, you can use it to authenticate API calls as shown below.</p>

<p>Set the authentication to No Auth and pass the following headers.</p>

<h4 id="required-headers">Required Headers</h4>

<table><thead>
<tr>
<th>Header</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>X-CAP-API-OAUTH-TOKEN*</td>
<td>Generated access token. If the token expires, you need to regenerate the access token.</td>
</tr>
<tr>
<td>Content-Type*</td>
<td>This should be set as application/json</td>
</tr>
<tr>
<td>Accept*</td>
<td>This should also be set as application/json</td>
</tr>
<tr>
<td>X-CAP-API-ATTRIBUTION-TILL-CODE</td>
<td>Till code from which you want to POST data. By default, the Till associated with the client key and secret is mapped if this is not passed.</td>
</tr>
</tbody></table>

<aside class="notice">Parameters marked with * are mandatory.</aside>

<p>For example, to get transaction details, you can use the following details. Before making a API call, make sure the token has access to the required resource.</p>

<p><strong>Headers</strong></p>

<p>Accept | application/json Content-Type | application/json X-CAP-API-OAUTH-TOKEN | eyJraWQiOiJrMSIsImFsZyI6IlJTMjU2In0.wiOlwiV1JJ…</p>

<blockquote>
<p>Sample Request URL
<code class="prettyprint">html
https://eu.api.capillarytech.com/v2/transaction/38233952?type=REGULAR
</code></p>
</blockquote>

<h3 id="request-url-format">Request URL Format</h3>

<p><code class="prettyprint">https://{host}/v2/{resource}/{endpoint}?{query params}</code></p>

<table><thead>
<tr>
<th>Entry</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Host</td>
<td>The server to which the API calls are made, usually the cluster URL. <br> * India: apac.intouch.capillary.co.in<br> * APAC2: apac2.intouch.capillarytech.com<br> * EU: eu.intouch.capillarytech.com<br> * US: us.intouch.capillarytech.com<br> * CN: intouch.capillarytech.cn.com</td>
</tr>
<tr>
<td>BasePath</td>
<td>v2 or v3(API version)</td>
</tr>
<tr>
<td>Resource</td>
<td>Provide the appropriate entity based on the action to be performed. <strong>Supported Resources</strong>: customers, communications, coupon, organization, points, product, store, transaction, goodwill requests, add events, integration resources, referral, request and other resources.</td>
</tr>
<tr>
<td>HTTP Methods</td>
<td>The Capillary Cloud REST APIs support the standard HTTP methods GET, PUT, DELETE and POST.</td>
</tr>
<tr>
<td>Response Format</td>
<td>JSON. All V2 and V3 APIs support only JSON response.</td>
</tr>
</tbody></table>

<h2 id="response-codes">Response Codes</h2>

<p>The following are global success and error codes. The response codes of each resource are provided in the respective sections.</p>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Global request success.</td>
</tr>
<tr>
<td>201</td>
<td>One or more requests have failed due to errors.</td>
</tr>
<tr>
<td>400</td>
<td>Invalid input. Please check request body parameters or input xml/json. <br> Invalid path parameter. <br>Invalid X-CAP-API-ATTRIBUTION-LOOKUP-TYPE specified.<br> Error with range passed or array in indexing.</td>
</tr>
<tr>
<td>401</td>
<td>Authentication failed. Please check username and password.</td>
</tr>
<tr>
<td>403</td>
<td>V2 is not enabled for the org. <br> Mandatory field is missing. Field {x} is mandatory.</td>
</tr>
<tr>
<td>404</td>
<td>Incorrect resource or resource not found.</td>
</tr>
<tr>
<td>405</td>
<td>The operation is not supported for the resource.</td>
</tr>
<tr>
<td>415</td>
<td>Unsupported media type.</td>
</tr>
<tr>
<td>461</td>
<td>Search Engine is busy or unable to respond. Please try after some time.</td>
</tr>
<tr>
<td>500</td>
<td>Requests have failed due to errors.</td>
</tr>
<tr>
<td>521</td>
<td>Multiple actions are running for the same customer. Please try after some time.</td>
</tr>
<tr>
<td>1060</td>
<td>Batch limit size exceeded.</td>
</tr>
<tr>
<td>1061</td>
<td>X-CAP-API-ATTRIBUTION-LOOKUP-TYPE header required with X-CAP-API-ATTRIBUTION-LOOKUP header.</td>
</tr>
<tr>
<td>1062</td>
<td>Invalid test and control status.</td>
</tr>
<tr>
<td>1064</td>
<td>Invalid org ID passed.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
      </div>
    </div>
	<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136354191-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-136354191-1');
</script>

<!-- Feedback widget -->

<script>
	window.fwSettings={
	'widget_id':4000000058
	};
	!function(){if("function"!=typeof window.FreshworksWidget){var n=function(){n.q.push(arguments)};n.q=[],window.FreshworksWidget=n}}() 
</script>
<script type='text/javascript' src='https://widget.freshworks.com/widgets/4000000058.js' async defer></script>

<!-- 

<div class="feedback--container" style="display: none;">
<div class="feedback--modal">
<a class="feedback--modal-close">&times;</a>
<iframe title="Feedback Form" class="freshwidget-embedded-form" id="freshwidget-embedded-form" src="https://support.capillarytech.com/widgets/feedback_widget/new?&widgetType=embedded&formTitle=Help+%26+Support&submitTitle=Submit&submitThanks=Thank+you+for+your+valuable+feedback.+We+will+get+back+to+you+soon.&screenshot=No&searchArea=no" scrolling="no" height="500px" width="100%" frameborder="0">
</iframe>
</div>
</div>

<div class="fab--container">
       <button class="fab--button fab--button__feedback">✍️ Give feedback</button>
</div>
 -->

  </body>
</html>

